

package servlet;

​

import model.User;

import service.UserService;

​

import javax.servlet.ServletException;

import javax.servlet.http.HttpServlet;

import javax.servlet.http.HttpServletRequest;

import javax.servlet.http.HttpServletResponse;

import java.io.IOException;

import java.io.PrintWriter;

​

public class LoginServlet extends HttpServlet {

​

   // private final AccountService accountService;

    private final UserService userService;

​

    public LoginServlet(UserService userService) {

        this.userService =userService;

    }

​

  //  public LoginServlet() {

​

 //   }

​

​

    @Override

    protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {

        //super.doPost(req, resp);

​

​

        String login = req.getParameter("email");

        String pass = req.getParameter("password");

​

        resp.setContentType("text/html;charset=utf-8");

​

        User profile = userService.getUserByEmail(login);

​

        if (profile != null){

            if(profile.getEmail().equals(login)&&profile.getPassword().equals(pass)){

                resp.setStatus(HttpServletResponse.SC_OK);

                userService.AddAuth(profile);

                resp.getWriter().print("Autorized:" + login );

            }else {

                resp.setStatus(HttpServletResponse.SC_UNAUTHORIZED);

                resp.getWriter().print("Unautorized");

            }

        }else{

            resp.setStatus(HttpServletResponse.SC_BAD_REQUEST);

        }

        /*if (login == null || pass == null) {

            resp.setContentType("text/html;charset=utf-8");

            resp.setStatus(HttpServletResponse.SC_BAD_REQUEST);

            return;

        }

​

        //User profile = userService.getUserById(Long.parseLong(login));

       // User profile = userService.getUserById(login);

        //User profile = userService.getUserByLogin(login);

       User profile =  (User) userService.getUserByEmail(login);

​

        if (profile == null || !pass.equals(profile.getPassword())) {

            resp.setContentType("text/html;charset=utf-8");

            resp.getWriter().println("Unauthorized");

            resp.setStatus(HttpServletResponse.SC_UNAUTHORIZED);

​

        } else {

​

            resp.setContentType("text/html;charset=utf-8");

            resp.getWriter().println("Authorized: " + login);

            resp.setStatus(HttpServletResponse.SC_OK);

        } */

    }

​

    @Override

    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {

       /* resp.setContentType("text/html;charset=utf-8");

        PrintWriter printWriter = resp.getWriter();

        printWriter.println(HttpServletResponse.SC_OK);*/

    }

